<?xml version="1.0"?>

<custom-sql>
	<sql id="com.sambaash.platform.srv.spchat.service.persistence.EntryFinder.findByEmptyContent">
		<![CDATA[
			SELECT
				{SPChatEntry.*}
			FROM
				SPChatEntry
			WHERE
				(fromUserId = ?) AND
				(toUserId = ?) AND
				(content = '' OR content IS NULL)
			ORDER BY
				createDate DESC
		]]>
	</sql>
	<sql id="com.sambaash.platform.srv.spchat.service.persistence.EntryFinder.findByNew">
		<![CDATA[
			SELECT
				{SPChatEntry.*}
			FROM
				SPChatEntry
			WHERE
				(
					(fromUserId = ?) OR (toUserId = ?)
				) AND
				(flag = ?)
			ORDER BY
				createDate DESC
		]]>
	</sql>
	<sql id="com.sambaash.platform.srv.spchat.service.persistence.EntryFinder.findByOld">
		<![CDATA[
			SELECT
				{SPChatEntry.*}
			FROM
				SPChatEntry
			WHERE
				(createDate < ?)
			ORDER BY
				createDate DESC
		]]>
	</sql>
	<sql id="com.sambaash.platform.srv.spchat.service.persistence.StatusFinder.findByModifiedDate">
		<![CDATA[
			SELECT
				SPChatStatus.awake AS awake, User_.firstName AS firstName, Group_.groupId as groupId, User_.lastName AS lastName, User_.middleName AS middleName, User_.portraitId AS portraitId, User_.screenName AS screenName, User_.userId AS userId, User_.uuid_ AS userUuid
			FROM
				SPChatStatus
			INNER JOIN
				User_ ON
					(User_.userId = SPChatStatus.userId)
			INNER JOIN
				Group_ ON
					(
						(Group_.classPK = User_.userId) AND
						(Group_.companyId = User_.companyId)
					)
			WHERE
				(Group_.classNameId = ?) AND
				(User_.companyId = ?) AND
				(User_.userId != ?) AND
				(SPChatStatus.modifiedDate > ?) AND
				(SPChatStatus.online_ = [$TRUE$])
			ORDER BY
				SPChatStatus.awake ASC,
				User_.firstName ASC,
				User_.middleName ASC,
				User_.lastName ASC
		]]>
	</sql>
	<sql id="com.sambaash.platform.srv.spchat.service.persistence.StatusFinder.findBySocialRelationTypes">
		<![CDATA[
			SELECT DISTINCT
				SPChatStatus.awake AS awake, User_.firstName AS firstName, Group_.groupId as groupId, User_.lastName AS lastName, User_.middleName AS middleName, User_.portraitId AS portraitId, User_.screenName AS screenName, User_.userId AS userId, User_.uuid_ AS userUuid
			FROM
				SPChatStatus
			INNER JOIN
				User_ ON
					(User_.userId = SPChatStatus.userId)
			INNER JOIN
				Group_ ON
					(
						(Group_.classPK = User_.userId) AND
						(Group_.companyId = User_.companyId)
					)
			INNER JOIN
				SocialRelation ON
					(SocialRelation.userId2 = User_.userId)
			WHERE
				(Group_.classNameId = ?) AND
				(SocialRelation.userId1 = ?) AND
				[$SOCIAL_RELATION_TYPES$]
				(User_.companyId = ?) AND
				(User_.userId != ?) AND
				(SPChatStatus.modifiedDate > ?) AND
				(SPChatStatus.online_ = [$TRUE$])
			ORDER BY
				SPChatStatus.awake ASC,
				User_.firstName ASC,
				User_.middleName ASC,
				User_.lastName ASC
		]]>
	</sql>
	<sql id="com.sambaash.platform.srv.spchat.service.persistence.StatusFinder.findByUsersGroups">
		<![CDATA[
			SELECT DISTINCT
				SPChatStatus.awake AS awake, User_.firstName AS firstName, Group_.groupId as groupId, User_.lastName AS lastName, User_.middleName AS middleName, User_.portraitId AS portraitId, User_.screenName AS screenName, User_.userId AS userId, User_.uuid_ AS userUuid
			FROM
				SPChatStatus
			INNER JOIN
				User_ ON
					(User_.userId = SPChatStatus.userId)
			INNER JOIN
				Users_Groups ON
					(Users_Groups.userId = User_.userId)
			INNER JOIN
				Group_ ON
					(
						(Group_.classPK = User_.userId) AND
						(Group_.companyId = User_.companyId)
					)
			WHERE
				(Group_.classNameId = ?) AND
				(User_.companyId = ?) AND
				(User_.userId != ?) AND
				(Users_Groups.groupId IN
					(
						SELECT
							Users_Groups.groupId
						FROM
							Users_Groups [$USERS_GROUPS_JOIN$]
						WHERE
							(userId = ?) [$USERS_GROUPS_WHERE$]
					)
				) AND
				(SPChatStatus.modifiedDate > ?) AND
				(SPChatStatus.online_ = [$TRUE$])
			ORDER BY
				SPChatStatus.awake ASC,
				User_.firstName ASC,
				User_.middleName ASC,
				User_.lastName ASC
		]]>
	</sql>
</custom-sql>